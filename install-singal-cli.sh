#!/bin/bash

# Check if user is root
if [[ $EUID -ne 0 ]]; then
   echo "This script must be run as root"
   exit 1
fi

# update the package manager
apt update

# install the default Java runtime environment
apt-get install default-jre

# install the libunixsocket-java package
apt-get install libunixsocket-java

# install the OpenJDK Java Development Kit and Java Runtime Environment
apt install openjdk-17-jdk openjdk-17-jre

# ask the user to visit the GitHub releases page and enter the latest version
read -p "Please visit https://github.com/AsamK/signal-cli/releases to get the latest version
Please enter the latest version for example 0.11.6: " version

# download the Signal CLI release for Linux
wget "https://github.com/AsamK/signal-cli/releases/download/v${version}/signal-cli-${version}-Linux.tar.gz"

# extract the Signal CLI release to the /opt directory
tar xf "signal-cli-${version}-Linux.tar.gz" -C /opt

# create a symbolic link to the Signal CLI executable
ln -sf "/opt/signal-cli-${version}/bin/signal-cli" /usr/local/bin/

# ask the user to enter their phone number
read -p "Please Enter Phone number for example +CCXXXXXXXXX: " phone_num

# register the phone number with Signal CLI
signal-cli -u "${phone_num}" register

# ask the user to enter the captcha
read -p "Enter captcha: " captcha

# complete the registration process with the captcha
signal-cli -u "${phone_num}" register --captcha "${captcha}"

# ask the user to enter the OTP
read -p "Enter OTP sms code: " otp

# verify the phone number with the OTP
signal-cli -u "${phone_num}" verify "${otp}"

# start the Signal CLI daemon
signal-cli -u "${phone_num}" daemon --dbus &

# reminder to run the Signal CLI daemon when the system restarts
echo "To start the Signal CLI daemon on system startup, run the following command:"
echo "signal-cli -u ${phone_num} daemon --dbus
